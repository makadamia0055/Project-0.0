<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<link rel="stylesheet" href="../component/bootstrap4/bootstrap.min.css">
	<script src="../component/bootstrap4/jquery.js"></script>
	<script src="../component/bootstrap4/popper.min.js"></script>
	<script src="../component/bootstrap4/boostrap.bundle.min.js"></script>
	<link rel="stylesheet" href="../style.css" />
	<link rel="stylesheet" href="./team_common.css">
	<style>
		.bsPark{
			position: relative;
			display: inline-block;
			width: 1000px; height: 600px;
			border-radius: 5px;
			background-image: url(./baseballpark.jpg);
			background-size: 1000px 600px;
		}
		/* .bench{
			position: absolute;
			bottom:0px;
			width: 0;
			height:0;
			border-bottom: 100px solid lightgray;
			border-top: 150px solid transparent;
			border-left: 200px solid lightgray;
			border-right: 200px solid transparent;
		} */
		.right-panel{
			float: right;
		}
		.box-player{
			border: 1px solid black;
			background-color: rgb(255, 255, 255);
			border-radius: 5px;
		}
		.box-player.selected{
			background-color: rgb(243, 241, 111);
		}
		.icon-player{
			width: 75px;
			height: 75px;
			border-radius: 32px;
		}
		.table-position{
			table-layout: fixed;
			background-color: rgba(255, 255, 255, 0.8);
			position: absolute;
			display: inline-block;
			border-radius: 5px;
			height: 100px; width: 100px;
		}
		.table-position .name-position{
			text-align: center;
		}
		
		.table-position[data-position="1"]{
			top: 350px;
			left: 450px;
		}
		.table-position[data-position="2"]{
			bottom: -16px;
			left: 450px;
		}
		.table-position[data-position="3"]{
			top: 350px;
			left: 720px;
		}
		.table-position[data-position="4"]{
			top: 200px;
			left: 450px;
		}
		.table-position[data-position="5"]{
			top: 350px;
			right: 720px;
		}
		.table-position[data-position="6"]{
			top: 250px;
			right: 600px;
		}
		.table-position[data-position="7"]{
			top: 100px;
			left: 720px;
		}
		.table-position[data-position="8"]{
			top: 50px;
			left: 450px;
		}
		.table-position[data-position="9"]{
			top: 100px;
			right: 720px;
		}
		col{
			width: 100%;
		}




		.table-bench{
			position: absolute;
			bottom: -100px;

		}
	</style>
</head>
<body>
	<iframe src="../component/topBar.html" class="topBar" frameborder="0"></iframe>

    <aside class="team-sidebar sidebar">
			<div>ㅇㅇ팀 라인업</div>
			<div>0월0일 vs xx팀</div>
			
			
			<div>선수 리스트</div>
			<div class="d-flex flex-wrap">
				<a href="#" class="box-player" draggable="true" data-plnum="1">
					<img src="./고양이 로고.png" draggable="false" class="icon-player " alt=""><br>
					<div class="name-player">77.선수이름1</div>
					<div class="">
						<span class="badge badge-pill badge-danger">투</span>
					</div>
					

				</a>
				

				</a>
			</div>

			<div>용병리스트</div>
			<div>지난 경기 리스트 불러오기</div>

		</aside>
	<section>
		<div>
			1. 수비 라인업 

		</div>
		<div class="bsPark">
			<div class="">
				<div class="table-position" data-position="1">
					<div class="name-position" draggable="false" data-position="1">투수</div>
					<div class="content-position" draggable="false" data-position="1"></div>
				</div>
				<div class="table-position" data-position="2">
					<div class="name-position" draggable="false" data-position="2">포수</div>
					<div class="content-position" draggable="false" data-position="2"></div>
				</div>
				<div class="table-position" data-position="3">
					<div class="name-position" draggable="false" data-position="3">1루수</div>
					<div class="content-position" draggable="false" data-position="3"></div>
				</div>
				<div class="table-position" data-position="4">
					<div class="name-position" draggable="false" data-position="4">2루수</div>
					<div class="content-position" draggable="false" data-position="4"></div>
				</div>
				<div class="table-position" data-position="5">
					<div class="name-position" draggable="false" data-position="5">3루수</div>
					<div class="content-position" draggable="false" data-position="5"></div>
				</div>
				<div class="table-position" data-position="6">
					<div class="name-position" draggable="false" data-position="6">유격수</div>
					<div class="content-position" draggable="false" data-position="6"></div>
				</div>
				<div class="table-position" data-position="7">
					<div class="name-position" draggable="false" data-position="7">우익수</div>
					<div class="content-position" draggable="false" data-position="7"></div>
				</div>
				<div class="table-position" data-position="8">
					<div class="name-position" draggable="false" data-position="8">중견수</div>
					<div class="content-position" draggable="false" data-position="8"></div>
				</div>
				<div class="table-position" data-position="9">
					<div class="name-position" draggable="false" data-position="9">좌익수</div>
					<div class="content-position" draggable="false" data-position="9"></div>
				</div>

			</div>
			<div class="bench"></div>
			<table class="table table-bordered table-bench">
				<thead>
					<tr>
						<th class="" data-position="1">벤치</th>
						
					</tr>
				</thead>
				<tbody>
					<tr>
						<td data-position="1"></td>
						
					</tr>
				</tbody>

			</table>
		</div>

		<div class="right-panel">
			 <button type="button" class="btn btn-pill btn-primary">중간 저장</button>
			 <button type="button" class="btn btn-pill btn-primary">초기화</button>
			 <button type="button" class="btn btn-pill btn-primary">제출</button><br>
			 <a href="https://kr.freepik.com/free-vector/baseball-field-isometric-composition_23505339.htm#query=%EC%95%BC%EA%B5%AC%EC%9E%A5&position=1&from_view=keyword&track=robertav1_2_sidr">구장 이미지 작가 macrovector</a> 출처 Freepik

		</div>
		<form action="POST">
			
		</form>
	</section>

</body>
<script>
	let _ml_ms_num = '${ms_num}';
	LineUp = {
		line : [],

		add(ml_tp_num){
			this.line.push(LUObj(ml_tp_num));
		},
		delete(ml_tp_num){
			for(let i = 0; i<this.line.length; i++){
				if(this.line[i].ml_tp_num==ml_tp_num){
					this.line.splice(i, 1);
				}
			}
		},
		search(ml_tp_num){
			return this.line.find(el=>el.ml_tp_num==ml_tp_num);
		}, 
		scan(){
			
		}
	}
	function LUObj(ml_tp_num){
		this.ml_ms_num = _ml_ms_num;
		this.ml_tp_num = ml_tp_num;

	}
	function LUObj(ml_tp_num, ml_battingorder, ml_type, ml_po_num){
		this.ml_ms_num = _ml_ms_num;
		this.ml_tp_num = ml_tp_num;
		this.ml_battingorder = ml_battingorder;
		this.ml_type = ml_type;
		this.ml_po_num = ml_po_num;

	}
	
	let playerBox = $('.box-player');
	let tableTd = $('.table-position');
	let contentBox = $('.content-position')
	let btnPlayer = $('.btn-player');
	let bench = $('.bench');
	
	let btnPlayerMove = false;

	playerBox.on("dragstart", function(e){
		e.originalEvent.dataTransfer.setData('text', $(e.target).data("plnum"));
		e.originalEvent.target.classList.add("dragging");
	})
	playerBox.on("dragend", function(e){
		e.originalEvent.target.classList.remove("dragging");
	})
	tableTd.on("dragover", (e)=>{
		e.preventDefault();
	})
	tableTd.on("drop", (e)=>{
		e.preventDefault();
		var data = e.originalEvent.dataTransfer.getData('text')
		putInPlayerBox(data, e);

		
	})
	tableTd.on("dragover", (e)=>{
		if(btnPlayerMove){
			e.originalEvent.dataTransfer.dropEffect = "move";
		}
		e.preventDefault();
	})
	
	// 드래그 버튼 만들어주는 팩토리 매서드
	function playerBoxFactorymethod(plNum){
		let str = '<button class="btn btn-sm btn-primary btn-player" draggable="true" data-plnum="'+ plNum+ '">';
		let playerName;
		for(let i of playerBox) {
			if($(i).data('plnum')==plNum){
				playerName = $(i).find('.name-player').text(); 
			}
		}
		str += playerName + '</button>';
		return str;
	}

// 드래그 버튼 넣어주는 매서드
	function putInPlayerBox(data, e){
		// for(let i of playerBox) {
		// 	if($(i).data('plnum')==data){
		// 		if($(i).hasClass('selected')){
		// 			// 중복 선택시 다른 곳에서 지워주기 메소드 삽입
					clearPlayerBox(data);
		// 		}
		// 	}
		// }
		let str = playerBoxFactorymethod(data);
		let position = $(e.target).data('position');
		for(let j of contentBox){
			if($(j).data('position')==position){
				$(j).html(str);
			}
		}
		btnPlayer = $('.btn-player');
		
		btnPlayer.on("dragstart", (e)=>{
		e.originalEvent.dataTransfer.setData("text", $(e.target).data('plnum'))
		// e.originalEvent.dataTransfer.effectAllowed ="move";
		btnPlayerMove = true;
		})
		btnPlayer.on("dragend", (e)=>{
			let data = e.originalEvent.dataTransfer.getData('text');
			clearPlayerBox(data);
		})


	}
	// 현재 입력된 드래그 버튼 plnum인수로 받아 지워주는 매서드
	function clearPlayerBox(data){
		for(let j of contentBox){
			let btn =  $(j).find('.btn');
			if(btn.data('plnum')==data){
				$(j).html('');
			}
	}
}
	
	// tableTd.on("drop", (e)=>{
	// 	e.preventDefault();
	// 	if(btnPlayerMove){
	// 		playerName = e.originalEvent.dataTransfer.getData('text');
	// 		$(e.target).filter(tableTd).html(str + playerName + strEnd);
	// 		playerName = '';
	// 		btnPlayerMove = false;
	// 		return;
	// 	}
	// 	var data = e.originalEvent.dataTransfer.getData('plnum')
	// 	for(let i of playerBox) {
	// 		if($(i).data('plnum')==data){
	// 			playerName = $(i).find('.name-player').text(); 
	// 		}
	// 	}
	// 	$(e.target).filter(tableTd).html(str + playerName + strEnd);
	// 	playerName='';
	// })
	btnPlayer.on("dragstart", (e)=>{
		e.originalEvent.dataTransfer.setData("text", $(e.target).data('plnum'))
		// e.originalEvent.dataTransfer.effectAllowed ="move";
		btnPlayerMove = true;
	})
	btnPlayer.on("dragend", (e)=>{
		let data = e.originalEvent.dataTransfer.getData('text');
		clearPlayerBox(data);
	})
	
	
</script>
</html>